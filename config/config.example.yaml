# Bluesky News Aggregator Configuration
#
# SECURITY WARNING:
# - NEVER commit config.yaml with real credentials to git
# - Use environment variables for ALL secrets in production
# - Environment variables override these settings (see .env.example)
#
# Environment variable mapping:
#   database.password -> DB_PASSWORD
#   bluesky.password  -> BLUESKY_PASSWORD
#   server.cors_origin -> CORS_ALLOW_ORIGIN
#   etc. (see .env.example for full list)

database:
  host: localhost
  port: 5432
  user: postgres
  password: ""  # USE DB_PASSWORD env var in production!
  dbname: bluesky_news
  sslmode: disable  # Use 'require' in production!

bluesky:
  handle: your.handle.bsky.social
  password: ""  # USE BLUESKY_PASSWORD env var in production!
                # Generate app passwords at https://bsky.app/settings/app-passwords

server:
  host: 0.0.0.0
  port: 8080
  # TLS configuration (optional - for HTTPS)
  # tls_cert: /path/to/cert.pem
  # tls_key: /path/to/key.pem
  # CORS allowed origin (use specific domain in production)
  cors_origin: "*"  # CHANGE to specific domain in production!
  # Rate limiting (requests per minute per IP)
  rate_limit_rpm: 100

polling:
  interval_minutes: 15
  posts_per_page: 50          # Posts to fetch per API call
  max_concurrent: 10          # Concurrent user fetches
  rate_limit_ms: 100          # Delay between API calls

  # Initial ingestion settings
  initial_lookback_hours: 24  # How far back to fetch on first run
  max_retries: 3              # Retry failed requests
  retry_backoff_ms: 1000      # Initial retry delay (exponential)
  max_pages_per_user: 100     # Safety limit to prevent runaway fetches

aggregation:
  default_hours: 24
  max_results: 100

# Database cleanup and maintenance
cleanup:
  # Data retention period (hours)
  # Posts and links older than this are deleted
  retention_hours: 24

  # Periodic cleanup interval (minutes)
  # How often to run cleanup while services are running
  cleanup_interval_minutes: 60

  # Trending link threshold
  # Links with this many shares are kept regardless of age
  trending_threshold: 5

  # Cursor update interval (seconds)
  # How often to flush cursor to database (reduces write pressure)
  cursor_update_seconds: 10
